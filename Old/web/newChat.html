<!DOCTYPE html>
<html>
    <head>
        <title>
            newChat
        </title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>

    </head>
    <script>
        var sock = io();

        //1 chats = [
        //!     {
        //!         chatHeading = 12,
        //!         chatMessages = 2,
        //!         chats = [
        //!             {
        //!                 text:"hello there",
        //!                 sender:"some-username-12"
        //!             }

        //!         ]
        //!     }

        //! ]

        class utilities {
            constructor(){};
        
            getOppAngle(angle){
                if(angle+180>360){
                    return angle-180;
                }else{
                    return angle+180;
                }
            }

        }


        class chatMachine{
            constructor(sock){
                this.socket = sock;
                this.alpha =0;
                this.chats = [];
                this.loggedIn = false;
                this.globalDegreeDist = 20;
                this.socket.on("name",(name)=>{
                    this.name = name;
                    this.loggedIn = true;
                    console.log("Logged in as "+this.name);
                })
            }

            sendMessage(text,heading){
                console.log("Sending message")
                //check if chat exists
                var res = this.overChat(heading);
                if(res == false){

                }else{
                    var index = res;
                }

            }

            onDeviceMove(alpha){
                this.alpha = alpha;
                this.updateAlphaDisplay(alpha);

            }

            updateAlphaDisplay(alpha){
                document.getElementById("alphaDisplay").innerHTML = alpha;
            }
        }

        var cm = new chatMachine(sock);
        var util = new utilities();
        
        function loaded(){
            setCompass();
        }

        function setCompass(){
            window.addEventListener("wheel", (event)=>{
                        var delta = Math.sign(event.deltaY);
                        var alpha = cm.alpha;
                        alpha += delta*2;
                        if(alpha >= 360){
                            alpha = 0;
                        }else if(alpha < 0){
                            alpha = 360;
                        }
                        cm.onDeviceMove(alpha)
                    })
        }


    </script>
    <body onload="loaded()">
        <h1 id="alphaDisplay"></h1>
        <div style="height:25vh;width:40vh;border:1px solid red;"id="chatParent"></div>
        <input type="text" id="chatInput">
        <button value="Send" onclick="cm.sendMessage()">Send</button>
    </body>
</html>